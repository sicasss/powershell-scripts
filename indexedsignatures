# Ruta del archivo strings.txt
$basePath = Get-Location
$stringsFile = Join-Path $basePath "strings.txt"

# Verifica si existe el archivo
if (-Not (Test-Path $stringsFile)) {
    Write-Error "No se encontr√≥ el archivo strings.txt en el directorio actual."
    exit
}

# Lee los paths de .exe desde el archivo
$exePaths = Get-Content $stringsFile

foreach ($exePath in $exePaths) {
    Write-Host "`nAnalizando: $exePath"

    if (Test-Path $exePath) {
        # Verifica firma digital
        try {
            $signature = Get-AuthenticodeSignature $exePath
            if ($signature.Status -eq 'Valid') {
                Write-Host "‚úî Firma digital v√°lida."
            } elseif ($signature.Status -eq 'NotSigned') {
                Write-Host "‚ö† El archivo no tiene firma digital."
            } else {
                Write-Host "‚ùå Firma digital inv√°lida o corrupta."
            }
        } catch {
            Write-Host "‚ùå Error al verificar la firma: $_"
        }
    } else {
        Write-Host "‚ùå El archivo no existe. Buscando en el USN Journal..."

        # Extrae la unidad del path
        $drive = ($exePath -split ':')[0] + ":"

        # Usa fsutil para consultar el USN Journal (requiere privilegios elevados)
        try {
            $usnOutput = fsutil usn readdata $drive | Out-String
            if ($usnOutput -match [regex]::Escape($exePath)) {
                Write-Host "üîç Se encontr√≥ una entrada en el USN Journal relacionada con el archivo."
            } else {
                Write-Host "‚ùå No se encontr√≥ informaci√≥n en el USN Journal."
            }
        } catch {
            Write-Host "‚ùå Error al acceder al USN Journal: $_"
        }
    }
}
